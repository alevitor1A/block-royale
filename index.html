<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Block Royale - Boss Update</title>
    <style>
        body { background: #0a0a0c; margin: 0; overflow: hidden; font-family: 'Segoe UI', sans-serif; color: white; user-select: none; }
        canvas { display: block; background: radial-gradient(circle, #1e1e24 0%, #111116 100%); cursor: crosshair; }

        /* HUD Principal */
        #ui-layer { position: absolute; top: 20px; left: 20px; pointer-events: none; display: flex; flex-direction: column; gap: 8px; }
        .stat-box { background: rgba(0, 0, 0, 0.85); padding: 12px 20px; border-radius: 8px; border-left: 5px solid #00d2ff; font-weight: 900; font-size: 13px; text-transform: uppercase; box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        .stat-box span { color: #00d2ff; font-size: 16px; }
        .gold span { color: #ffee00; }
        .danger { border-left-color: #ff4444; }

        /* Barra de Vida do Boss */
        #boss-ui { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); width: 400px; text-align: center; display: none; }
        #boss-bar { width: 100%; height: 20px; background: #333; border: 2px solid #ff4444; border-radius: 10px; overflow: hidden; }
        #boss-fill { width: 100%; height: 100%; background: #ff4444; transition: width 0.2s; }

        /* Loja */
        #shop-overlay { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(20, 20, 25, 0.98); padding: 30px; border-radius: 20px; border: 2px solid #ffee00; display: none; text-align: center; z-index: 50; box-shadow: 0 0 50px rgba(255, 238, 0, 0.2); }
        .shop-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .shop-item { background: #25252b; padding: 15px; border-radius: 10px; cursor: pointer; border: 1px solid #444; }
        .shop-item:hover { border-color: #ffee00; background: #333; }

        #overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: flex; justify-content: center; align-items: center; z-index: 100; }
        #login-card { background: #16161a; padding: 50px; border-radius: 20px; text-align: center; }
        input { padding: 15px; width: 80%; margin-bottom: 20px; background: #000; color: #fff; border: 1px solid #00d2ff; text-align: center; }
        button { padding: 15px; width: 100%; background: #00d2ff; border: none; font-weight: bold; cursor: pointer; border-radius: 8px; }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div class="stat-box">PLAYER: <span id="ui-name">---</span></div>
        <div class="stat-box gold">MOEDAS: <span id="ui-coins">0</span></div>
        <div class="stat-box danger">HP: <span id="ui-hp">100</span>%</div>
        <div class="stat-box">AMMO: <span id="ui-ammo">20</span>/20</div>
        <div class="stat-box" style="border-left-color: #ffee00;">ONDA: <span id="ui-wave">1</span></div>
    </div>

    <div id="boss-ui">
        <div style="color: #ff4444; font-weight: bold; margin-bottom: 5px; text-shadow: 0 0 10px #ff4444;">BOSS CHEGOU!</div>
        <div id="boss-bar"><div id="boss-fill"></div></div>
    </div>

    <div id="shop-overlay">
        <h2 style="color:#ffee00;">LOJA DE UPGRADES</h2>
        <div class="shop-grid">
            <div class="shop-item" onclick="buyUpgrade('triple')"><h3>TIRO TRIPLO</h3><p>50 Moedas</p></div>
            <div class="shop-item" onclick="buyUpgrade('heal')"><h3>CURAR TUDO</h3><p>30 Moedas</p></div>
            <div class="shop-item" onclick="buyUpgrade('speed')"><h3>VELOCIDADE+</h3><p>40 Moedas</p></div>
            <div class="shop-item" onclick="nextWave()" style="background:#00d2ff; color:#000;"><h3>PRÓXIMA ONDA</h3><p>GRÁTIS</p></div>
        </div>
    </div>

    <div id="overlay">
        <div id="login-card">
            <h1>BLOCK ROYALE</h1>
            <input type="text" id="nick-input" placeholder="SEU NICK..." maxlength="12">
            <button id="btn-play">INICIAR JOGO</button>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script type="module">
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let gameActive = false, inShop = false, bossActive = false;
        let coins = 0, wave = 1, sessionKills = 0;
        let hasTripleShot = false, playerSpeed = 4;

        const player = { x: 0, y: 0, size: 30, hp: 100, ammo: 20 };
        let enemies = [], bullets = [], keys = {}, mouse = { x: 0, y: 0 };

        function updateUI() {
            document.getElementById('ui-coins').innerText = coins;
            document.getElementById('ui-hp').innerText = Math.ceil(player.hp);
            document.getElementById('ui-ammo').innerText = player.ammo;
            document.getElementById('ui-wave').innerText = wave;
        }

        window.buyUpgrade = function(type) {
            if(type === 'triple' && coins >= 50 && !hasTripleShot) { coins -= 50; hasTripleShot = true; }
            if(type === 'heal' && coins >= 30) { coins -= 30; player.hp = 100; }
            if(type === 'speed' && coins >= 40) { coins -= 40; playerSpeed += 1; }
            updateUI();
        }

        window.nextWave = function() {
            document.getElementById('shop-overlay').style.display = 'none';
            document.getElementById('boss-ui').style.display = 'none';
            inShop = false;
            if(wave % 5 === 0) spawnBoss();
            else for(let i=0; i < 3 + wave; i++) spawnEnemy();
            updateUI();
        }

        function spawnEnemy() {
            const side = Math.floor(Math.random() * 4);
            let x, y;
            if(side===0){x=Math.random()*canvas.width; y=-50;}
            else if(side===1){x=canvas.width+50; y=Math.random()*canvas.height;}
            else if(side===2){x=Math.random()*canvas.width; y=canvas.height+50;}
            else {x=-50; y=Math.random()*canvas.height;}
            enemies.push({ x, y, speed: 1.8 + (wave*0.1), hp: 1, size: 30, color: '#ff4444', isBoss: false });
        }

        function spawnBoss() {
            bossActive = true;
            document.getElementById('boss-ui').style.display = 'block';
            enemies.push({ x: canvas.width/2, y: -100, speed: 1.2, hp: 30 + (wave*10), maxHp: 30 + (wave*10), size: 120, color: '#ff0055', isBoss: true });
        }

        function drawFace(en) {
            ctx.fillStyle = 'black';
            let s = en.size;
            if(en.isBoss) {
                ctx.fillRect(en.x - s/4, en.y - s/4, 20, 20); ctx.fillRect(en.x + s/8, en.y - s/4, 20, 20);
                ctx.fillRect(en.x - s/3, en.y + s/6, s/1.5, 10);
            } else {
                ctx.fillRect(en.x - s/4, en.y - s/4, 5, 5); ctx.fillRect(en.x + s/8, en.y - s/4, 5, 5);
                ctx.fillRect(en.x - s/6, en.y + s/8, s/3, 2);
            }
        }

        function gameLoop() {
            if (!gameActive || inShop) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Jogador
            if (keys['w']) player.y -= playerSpeed; if (keys['s']) player.y += playerSpeed;
            if (keys['a']) player.x -= playerSpeed; if (keys['d']) player.x += playerSpeed;
            ctx.fillStyle = '#00d2ff'; ctx.fillRect(player.x-15, player.y-15, 30, 30);

            // Inimigos
            enemies.forEach((en, i) => {
                const dist = Math.hypot(player.x - en.x, player.y - en.y);
                en.x += ((player.x - en.x)/dist) * en.speed;
                en.y += ((player.y - en.y)/dist) * en.speed;
                
                ctx.fillStyle = en.color;
                ctx.fillRect(en.x - en.size/2, en.y - en.size/2, en.size, en.size);
                drawFace(en);

                if(en.isBoss) {
                    document.getElementById('boss-fill').style.width = (en.hp / en.maxHp * 100) + '%';
                }

                if(dist < en.size/2 + 15) {
                    player.hp -= en.isBoss ? 1 : 0.5; updateUI();
                    if(player.hp <= 0) location.reload();
                }
            });

            // Balas
            bullets.forEach((b, bi) => {
                b.x += b.vx; b.y += b.vy;
                ctx.fillStyle = 'yellow'; ctx.beginPath(); ctx.arc(b.x, b.y, 5, 0, 7); ctx.fill();
                enemies.forEach((en, ei) => {
                    if(Math.hypot(b.x - en.x, b.y - en.y) < en.size/2) {
                        en.hp--; bullets.splice(bi, 1);
                        if(en.hp <= 0) {
                            coins += en.isBoss ? 100 : 10;
                            enemies.splice(ei, 1);
                            if(enemies.length === 0) { 
                                wave++; inShop = true; 
                                document.getElementById('shop-overlay').style.display = 'block'; 
                            }
                        }
                    }
                });
            });

            requestAnimationFrame(gameLoop);
        }

        window.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
        window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);
        window.addEventListener('mousedown', () => {
            if(!gameActive || inShop || player.ammo <= 0) return;
            const ang = Math.atan2(mouse.y - player.y, mouse.x - player.x);
            const shoot = (a) => bullets.push({x: player.x, y: player.y, vx: Math.cos(a)*15, vy: Math.sin(a)*15});
            shoot(ang);
            if(hasTripleShot) { shoot(ang+0.2); shoot(ang-0.2); }
            player.ammo--; updateUI();
            if(player.ammo <= 0) setTimeout(() => { player.ammo=20; updateUI(); }, 1000);
        });
        window.addEventListener('mousemove', e => { mouse.x = e.clientX; mouse.y = e.clientY; });
        document.getElementById('btn-play').addEventListener('click', () => {
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('ui-name').innerText = document.getElementById('nick-input').value;
            gameActive = true; player.x = canvas.width/2; player.y = canvas.height/2;
            nextWave(); gameLoop();
        });
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    </script>
</body>
</html>
